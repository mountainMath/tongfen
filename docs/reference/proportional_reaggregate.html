<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Dasymetric downsampling — proportional_reaggregate • tongfen</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Dasymetric downsampling — proportional_reaggregate"><meta property="og:description" content="
Proportionally re-aggregate hierarchical data to lower-level w.r.t. values of the *base* variable
Also handles cases where lower level data may be available but blinded at times by filling in data from higher level
Data at lower aggregation levels may not add up to the more accurate aggregate counts.
This function distributes the aggregate level counts proportionally (by population) to the containing lower
level geographic regions."><meta property="og:image" content="https://mountainmath.github.io/tongfen/logo.png"><meta property="og:image:alt" content="tongfen"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@vb_jens"><meta name="twitter:site" content="https://mountainmath.github.io/tongfen/"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tongfen</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/tongfen.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/polling_districts.html">Polling Districts</a>
    </li>
    <li>
      <a href="../articles/tongfen_ca.html">TongFen for Canadian census data</a>
    </li>
    <li>
      <a href="../articles/tongfen-ca-estimate.html">Estimating Canadian data on custom geographies</a>
    </li>
    <li>
      <a href="../articles/tongfen_us.html">TongFen for US census data</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mountainMath/tongfen/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Dasymetric downsampling</h1>
    <small class="dont-index">Source: <a href="https://github.com/mountainMath/tongfen/blob/HEAD/R/tongfen.R" class="external-link"><code>R/tongfen.R</code></a></small>
    <div class="hidden name"><code>proportional_reaggregate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing" class="external-link"><img src="figures/lifecycle-maturing.svg" alt="[Maturing]"></a></p>
<p>Proportionally re-aggregate hierarchical data to lower-level w.r.t. values of the *base* variable
Also handles cases where lower level data may be available but blinded at times by filling in data from higher level</p>
<p>Data at lower aggregation levels may not add up to the more accurate aggregate counts.
This function distributes the aggregate level counts proportionally (by population) to the containing lower
level geographic regions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">proportional_reaggregate</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">parent_data</span>,</span>
<span>  <span class="va">geo_match</span>,</span>
<span>  <span class="va">categories</span>,</span>
<span>  base <span class="op">=</span> <span class="st">"Population"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>The base geographic data</p></dd>


<dt>parent_data</dt>
<dd><p>Higher level geographic data</p></dd>


<dt>geo_match</dt>
<dd><p>A named string informing on what column names to match data and parent_data</p></dd>


<dt>categories</dt>
<dd><p>Vector of column names to re-aggregate</p></dd>


<dt>base</dt>
<dd><p>Column name to use for proportional weighting when re-aggregating</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>dataframe with downsampled variables from parent_data</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Proportionally reaggregate visible minority data from dissemination area 2016</span></span></span>
<span class="r-in"><span><span class="co"># census data to dissemination block geography, proportionally based on dissemination</span></span></span>
<span class="r-in"><span><span class="co"># block population</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>CSD<span class="op">=</span><span class="st">"5915022"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu">cancensus</span><span class="fu">::</span><span class="fu"><a href="https://mountainmath.github.io/cancensus/reference/child_census_vectors.html" class="external-link">child_census_vectors</a></span><span class="op">(</span><span class="st">"v_CA16_3954"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">da_data</span> <span class="op">&lt;-</span> <span class="fu">cancensus</span><span class="fu">::</span><span class="fu"><a href="https://mountainmath.github.io/cancensus/reference/get_census.html" class="external-link">get_census</a></span><span class="op">(</span><span class="st">"CA16"</span>,regions<span class="op">=</span><span class="va">regions</span>,</span></span>
<span class="r-in"><span>                                 vectors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">variables</span><span class="op">$</span><span class="va">vector</span>,<span class="va">variables</span><span class="op">$</span><span class="va">label</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                 level<span class="op">=</span><span class="st">"DA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">geo_data</span> <span class="op">&lt;-</span> <span class="fu">cancensus</span><span class="fu">::</span><span class="fu"><a href="https://mountainmath.github.io/cancensus/reference/get_census.html" class="external-link">get_census</a></span><span class="op">(</span><span class="st">"CA16"</span>,regions<span class="op">=</span><span class="va">regions</span>,geo_format<span class="op">=</span><span class="st">"sf"</span>,level<span class="op">=</span><span class="st">"DB"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">db_data</span> <span class="op">&lt;-</span> <span class="va">geo_data</span> <span class="op">%&gt;%</span> <span class="fu">proportional_reaggregate</span><span class="op">(</span><span class="va">da_data</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DA_UID"</span><span class="op">=</span><span class="st">"GeoUID"</span><span class="op">)</span>,<span class="va">variables</span><span class="op">$</span><span class="va">label</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://mountainmath.ca" class="external-link">Jens von Bergmann</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

