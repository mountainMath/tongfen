<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Make data based on different geographies comparable • tongfen</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Make data based on different geographies comparable">
<meta property="og:description" content="Several functions to allow comparisons of data across different geographies, in particular for Canadian census data from different censuses.">
<meta property="og:image" content="https://mountainmath.github.io/tongfen/logo.png">
<meta property="og:image:alt" content="tongfen">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@vb_jens">
<meta name="twitter:site" content="https://mountainmath.github.io/tongfen/">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tongfen</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/tongfen.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mountainMath/tongfen/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="tongfen" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tongfen" class="anchor"></a>tongfen</h1></div>

<p><a href="https://mountainmath.github.io/tongfen/index.html"><img src="https://raw.githubusercontent.com/mountainMath/tongfen/master/images/tongfen-sticker.png" alt="tongfen logo" align="right" width="25%" height="25%"></a> TongFen (通分) means to convert two fractions to the least common denominator, typically in preparation for further manipulation like addition or subtraction. In English, that’s a mouthful and sounds complicated. But in Chinese there is a word for this, TongFen, which makes this process appear very simple.</p>
<p>When working with geospatial datasets we often want to compare data that is given on different regions. For example census data and election data. Or data from two different censuses. To properly compare this data we first need to convert it to a common geography. The process to do this is quite analogous to the process of TongFen for fractions, so we appropriate this term to give it a simple name. Using the <strong>tongfen</strong> package, preparing data on disparate geographies for comparison by converting them to a common geography is as easy as typing <code>tongfen</code>.</p>
<div id="reference" class="section level3">
<h3 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h3>
<p><a href="https://mountainmath.github.io/tongfen/index.html"><strong>TongFen home page and reference guide</strong></a></p>
</div>
<div id="installing-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#installing-the-package" class="anchor"></a>Installing the package</h3>
<p>The package can be installed from GitHub.</p>
<pre><code><a href="https://devtools.r-lib.org//reference/remote-reexports.html">devtools::install_github("mountainmath/tongfen")
library(tongfen)</a></code></pre>
</div>
<div id="caching-correspondence-files" class="section level3">
<h3 class="hasAnchor">
<a href="#caching-correspondence-files" class="anchor"></a>Caching correspondence files</h3>
<p>The <code>get_tongfen_census_ct</code> and <code>get_tongfen_census_ct_from_da</code> methods make use of the StatCan correspondence files. To speed up this process it is useful to permanently cache these files instead of having to download them repeatedly. If caching is desired, set either</p>
<ul>
<li><code><a href="https://rdrr.io/r/base/options.html">options("tongfen.cache_path"="&lt;your local cache path&gt;")</a></code></li>
<li><code><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv("tongfen.cache_path"="&lt;your local cache path&gt;")</a></code></li>
<li><code><a href="https://rdrr.io/r/base/options.html">options("custom_data_path"="&lt;your local cache path&gt;")</a></code></li>
</ul>
<p>in your <code>.Rprofile</code> or <code>.Renviron</code> file.</p>
</div>
<div id="general-tongfen" class="section level2">
<h2 class="hasAnchor">
<a href="#general-tongfen" class="anchor"></a>General TongFen</h2>
<p>The <code>tongfen</code> package is build around the following basic <strong>TongFen workflow</strong>:</p>
<ol>
<li>Given a list of datasets on diverse geographies, <strong>generate a correspondence table</strong> that links the geographies and specifies how to aggregate them up to a (least) common geography via <code>estimate_tongfen_correspondence</code>.</li>
<li>
<strong>generate metadata</strong> that specifies how variables can be aggregated up, the <code>meta_for_additive_variables</code> function does this for additive variables.</li>
<li>Use the correspondence table and metadata to generate a dataset with variables from the original datasets aggregated up on a common geography via <code>tongfen_aggregate</code>.</li>
</ol>
<p>A convenience function to validate geographic TongFen fit via area comparison is available via <code>check_tongfen_areas</code>, it allows to explore and deal with spatial mismatches during TongFen.</p>
<div id="aggregation-of-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#aggregation-of-variables" class="anchor"></a>Aggregation of variables</h3>
<p>Finding a common tiling of several different yet congruent geographies is only one part of the problem TongFen addresses, aggregating up the variables is the other part. The <code>tongfen</code> package deals with this using a <em>metadata</em> table that specifies how variables should be aggregated. In it’s simplest form values are simply added up. The <code>meta_for_additive_variables</code> convenience function builds the metadata for additive variables. Metadata for non-additive variables like averages, ratios or percentages needs more care to build, it requires additional information on the <strong>parent variable</strong> that specifies the denominator of the average, ratio or percentage. Other data, like medians, can’t be aggregated up, although <code>tongfen</code> can provide estimates of medians on aggregated geographies by treating them as averages.</p>
</div>
</div>
<div id="data-specific-implementations" class="section level2">
<h2 class="hasAnchor">
<a href="#data-specific-implementations" class="anchor"></a>Data-specific implementations</h2>
<p>The need for TongFen comes up frequently with certain types of geographies. Census geographies is one such example. In some cases these data sources come with their own correspondence files that go beyond geographic matchup but also join regions to alleviate data integrity problems like geocoding issues.</p>
<p>In such cases it can be worthwhile to wrap data acquisition and TongFen into one convenience function, and also extend the TongFen <em>method</em> parameter to allow for external correspondence files to be used.</p>
<div id="canadian-census-data" class="section level3">
<h3 class="hasAnchor">
<a href="#canadian-census-data" class="anchor"></a>Canadian census data</h3>
<p>The package is well-integrated to work with Canadian census data in two essential ways.</p>
<ul>
<li>
<code>meta_for_ca_census_vectors</code> builds rich metadata for a given list of Canadian census variables by utilizing the metadata available via <a href="https://censusmapper.ca">CensusMapper</a>. In particular, this automates the proper aggregation of non-count variables like averages, ratios and percentages.</li>
<li>
<code>get_tongfen_ca_census</code> wraps the process of data acquisition (via CensusMapper and the <a href="https://mountainmath.github.io/cancensus/index.html"><strong>cancensus</strong> package</a> and tongfen into one convenience function. At the same time it adds the TongFen <code>method = "statcan"</code> option that uses the Statistics Canada correspondence files to build the common geography.</li>
<li>The <code>get_tongfen_correspondence_ca_census</code> function breaks out the correspondence generation to aid the process of accessing the Statistics Canada correspondence files (and better integration of generating correspondences for Canadian census geographies in general) to facilitate mixing in non-census data coming on census geographies, like for example <a href="https://www03.cmhc-schl.gc.ca/hmip-pimh">CMHC data</a>.</li>
</ul>
</div>
<div id="us-census-data" class="section level3">
<h3 class="hasAnchor">
<a href="#us-census-data" class="anchor"></a>US census data</h3>
<ul>
<li>
<code>get_tongfen_us_census</code> integrates the data acquisition (via the <a href="https://walker-data.com/tidycensus/index.html"><strong>tidycensus</strong> package</a>) with TongFen, and adds the tongfen <code>method = "census.gov"</code> to use the US Census Bureau correspondence files for matching.</li>
</ul>
</div>
</div>
<div id="other-implementations" class="section level2">
<h2 class="hasAnchor">
<a href="#other-implementations" class="anchor"></a>Other implementations</h2>
<p>The <code>tongfen</code> package is open to add extensions for other specialized data sources, as well as extensions of existing ones.</p>
</div>
<div id="fixed-target-geography-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#fixed-target-geography-estimation" class="anchor"></a>Fixed target geography estimation</h2>
<p>When geographies aren’t sufficiently congruent or the target geography is fixed, we won’t be able to use the <code>tongfen</code> methods to compute the data on a common geography but have to instead rely on estimates. The <code>tongfen_estimate</code> makes no assumption on the underlying geographies and returns estimates of the data on the target geography. It uses area-weighted interpolation to achieve this, and can be refined to dasymmetric estimates using the <code>proportional_reaggregate</code> function.</p>
<p>This method has the example that it works independent of the nature of the underlying geographies, but comes at the heavy price of only being an estimate. To be useful for research purposes we also need methods to estimate the errors this introduces and the effects this has on subsequent analysis results.</p>
<p>Methods to facilitate this are still under active development.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/mountainMath/tongfen/">https://​github.com/​mountainMath/​tongfen/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/mountainMath/tongfen/issues">https://​github.com/​mountainMath/​tongfen/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://mountainmath.ca">Jens von Bergmann</a> <br><small class="roles"> Author, maintainer </small>  <br><small>(creator and maintainer)</small>
</li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/mountainMath/tongfen"><img src="https://travis-ci.org/mountainMath/tongfen.svg?branch=master" alt="Build Status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://mountainmath.ca">Jens von Bergmann</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
